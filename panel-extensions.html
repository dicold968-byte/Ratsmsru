<script>
// --- More Tabs ("‚ãØ") Dropdown ---

// 1. –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Ç—Ä–æ–µ—Ç–æ—á–∏–µ –∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ "–µ—â—ë"
document.querySelector('#adminTabs').innerHTML += `
  <button class="panel-tab more-tab" data-tab="more" title="–ï—â—ë">‚ãØ</button>
`;
document.querySelector('#userTabs').innerHTML += `
  <button class="panel-tab more-tab" data-tab="more" title="–ï—â—ë">‚ãØ</button>
`;

// 2. –°–ø–∏—Å–æ–∫ "–µ—â—ë" –≤–∫–ª–∞–¥–æ–∫
const moreTabsAdmin = [
  {tab:"reports", label:"–û—Ç—á—ë—Ç—ã"},
  {tab:"apitokens", label:"API-—Ç–æ–∫–µ–Ω—ã"},
  {tab:"integrations", label:"–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏"},
  {tab:"calendar", label:"–ö–∞–ª–µ–Ω–¥–∞—Ä—å"},
  {tab:"docs", label:"–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"},
  {tab:"faq", label:"FAQ/–ü–æ–º–æ—â—å"},
  {tab:"themes", label:"–¢–µ–º—ã/–°—Ç–∏–ª–∏"},
  {tab:"syslogs", label:"–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏"},
  {tab:"backups", label:"–ë—ç–∫–∞–ø—ã"},
  {tab:"errors", label:"–û—à–∏–±–∫–∏"},
  {tab:"bulk", label:"–ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è"},
  {tab:"monitor", label:"–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥"},
  {tab:"advdash", label:"–î–∞—à–±–æ—Ä–¥—ã+"}
];
const moreTabsUser = [
  {tab:"calendar", label:"–ö–∞–ª–µ–Ω–¥–∞—Ä—å"},
  {tab:"faq", label:"FAQ/–ü–æ–º–æ—â—å"},
  {tab:"themes", label:"–¢–µ–º—ã/–°—Ç–∏–ª–∏"},
  {tab:"docs", label:"–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è"}
];

// 3. –ú–æ–¥–∞–ª—å–Ω–æ–µ –º–µ–Ω—é –¥–ª—è "–µ—â—ë"
function showMoreTabsModal(isAdmin=true) {
  const tabs = isAdmin ? moreTabsAdmin : moreTabsUser;
  showModal(`
    <div style="text-align:center;">
      <div style="font-size:1.18rem;margin-bottom:12px;color:#00ffe7;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏</div>
      <div>
        ${tabs.map(t=>`
          <button class="neon-btn" style="margin:5px 9px;font-size:1rem;padding:10px 21px;" onclick="chooseMoreTab('${t.tab}','${isAdmin? 'admin':'user'}')">${t.label}</button>
        `).join("")}
      </div>
    </div>
  `);
}
window.chooseMoreTab = function(tab, role) {
  closeModal();
  if(role==="admin") renderAdminTab(tab);
  else renderUserTab(tab);
}
// 4. –°–ª—É—à–∞—Ç–µ–ª–∏ –Ω–∞ —Ç—Ä–æ–µ—Ç–æ—á–∏–µ
document.querySelector('#adminTabs .more-tab').onclick = ()=>showMoreTabsModal(true);
document.querySelector('#userTabs .more-tab').onclick = ()=>showMoreTabsModal(false);

// 5. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—É–Ω–∫—Ü–∏–π-–≤–∫–ª–∞–¥–æ–∫
function renderAdminReports() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–û—Ç—á—ë—Ç—ã</div>
    <div>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –ø—Ä–æ—Å–º–æ—Ç—Ä –æ—Ç—á—ë—Ç–æ–≤ –∑–∞ –ø–µ—Ä–∏–æ–¥—ã.<br>
    <button class="neon-btn" style="margin:10px 0;">–°–∫–∞—á–∞—Ç—å PDF</button>
    <table class="table-list">
      <tr><th>–ü–µ—Ä–∏–æ–¥</th><th>–î–µ–≤–∞–π—Å—ã</th><th>–í–æ—Ä–∫–µ—Ä—ã</th><th>–û—à–∏–±–∫–∏</th></tr>
      <tr><td>–°–µ–Ω—Ç—è–±—Ä—å</td><td>12</td><td>5</td><td>1</td></tr>
      <tr><td>–ê–≤–≥—É—Å—Ç</td><td>10</td><td>3</td><td>0</td></tr>
    </table>
    </div>
  `;
}
function renderAdminAPITokens() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">API-—Ç–æ–∫–µ–Ω—ã</div>
    <div>
      <input class="neon-input" placeholder="–ù–æ–≤—ã–π —Ç–æ–∫–µ–Ω..." id="newApiToken">
      <button class="neon-btn" onclick="addApiToken()">–î–æ–±–∞–≤–∏—Ç—å</button>
      <ul id="apiTokensList" style="text-align:left;list-style:none;margin:15px 0 0 0;padding:0;">
        <li>abcdef123456 <button class="neon-btn" style="padding:4px 10px;font-size:0.93rem;" onclick="deleteApiToken(this)">–£–¥–∞–ª–∏—Ç—å</button></li>
        <li>ghijk789012 <button class="neon-btn" style="padding:4px 10px;font-size:0.93rem;" onclick="deleteApiToken(this)">–£–¥–∞–ª–∏—Ç—å</button></li>
      </ul>
    </div>
  `;
}
window.addApiToken = function() {
  let val = document.getElementById('newApiToken').value.trim();
  if(val) {
    let ul = document.getElementById('apiTokensList');
    ul.innerHTML += `<li>${val} <button class="neon-btn" style="padding:4px 10px;font-size:0.93rem;" onclick="deleteApiToken(this)">–£–¥–∞–ª–∏—Ç—å</button></li>`;
    showToast("–¢–æ–∫–µ–Ω –¥–æ–±–∞–≤–ª–µ–Ω","success");
    document.getElementById('newApiToken').value = "";
  }
}
window.deleteApiToken = function(btn) {
  btn.parentNode.remove();
  showToast("–¢–æ–∫–µ–Ω —É–¥–∞–ª—ë–Ω","success");
}
function renderAdminIntegrations() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏</div>
    <div>
      <label><input type="checkbox" checked> Telegram –±–æ—Ç—ã</label><br>
      <label><input type="checkbox"> Slack</label><br>
      <label><input type="checkbox"> Webhook</label><br>
      <button class="neon-btn" style="margin-top:10px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  `;
}
function renderAdminCalendar() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</div>
    <div>–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –∑–∞–¥–∞—á–∏ –∏ —Å–æ–±—ã—Ç–∏—è.<br><div style="margin-top:10px;">
    <input class="neon-input" type="date">
    <button class="neon-btn">–ù–∞–π—Ç–∏</button></div>
    <ul style="color:#69fefd;margin-top:8px;">
      <li>2025-09-30: –ê—É–¥–∏—Ç –ª–æ–≥–æ–≤</li>
      <li>2025-09-28: –û—Ç—á—ë—Ç</li>
    </ul>
    </div>
  `;
}
function renderAdminDocs() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</div>
    <div>
      <ul style="text-align:left;color:#69fefd;">
        <li><a href="#" style="color:#00ffe7;">API Reference</a></li>
        <li><a href="#" style="color:#00ffe7;">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É</a></li>
        <li><a href="#" style="color:#00ffe7;">FAQ</a></li>
      </ul>
    </div>
  `;
}
function renderAdminFAQ() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">FAQ/–ü–æ–º–æ—â—å</div>
    <div>
      <details><summary>–ö–∞–∫ –¥–æ–±–∞–≤–∏—Ç—å –¥–µ–≤–∞–π—Å?</summary>–í–∫–ª–∞–¥–∫–∞ "–î–µ–≤–∞–π—Å—ã" ‚Üí –¥–æ–±–∞–≤–∏—Ç—å.</details>
      <details><summary>–ö–∞–∫ —Å–º–µ–Ω–∏—Ç—å —Ç–µ–º—É?</summary>–í–∫–ª–∞–¥–∫–∞ "–¢–µ–º—ã/–°—Ç–∏–ª–∏" –∏–ª–∏ "–ù–∞—Å—Ç—Ä–æ–π–∫–∏".</details>
      <details><summary>–ì–¥–µ —Å–∫–∞—á–∞—Ç—å –æ—Ç—á—ë—Ç—ã?</summary>–í–∫–ª–∞–¥–∫–∞ "–û—Ç—á—ë—Ç—ã".</details>
    </div>
  `;
}
function renderAdminThemes() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–¢–µ–º—ã/–°—Ç–∏–ª–∏</div>
    <div>
      <button class="neon-btn" onclick="toggleTheme()">üåó –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</button>
      <button class="neon-btn" style="margin-left:10px;">+ –î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ—é —Ç–µ–º—É</button>
    </div>
  `;
}
function renderAdminSyslogs() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–æ–≥–∏</div>
    <div style="background:#232a3b;padding:10px 10px 10px 16px;border-radius:7px;max-height:135px;overflow-y:auto;">
      [2025-09-30 11:00] Start panel<br>
      [2025-09-30 11:01] Login: admin<br>
      [2025-09-30 11:02] Device added: Samsung<br>
      [2025-09-30 11:03] Backup created<br>
      [2025-09-30 11:04] Error: no connection<br>
    </div>
  `;
}
function renderAdminBackups() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–ë—ç–∫–∞–ø—ã</div>
    <div>
      <button class="neon-btn">–°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø</button>
      <button class="neon-btn" style="margin-left:10px;">–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å</button>
    </div>
    <ul style="color:#69fefd;margin-top:8px;">
      <li>2025-09-30-backup.zip <button class="neon-btn" style="padding:4px 10px;font-size:0.93rem;">–°–∫–∞—á–∞—Ç—å</button></li>
      <li>2025-09-28-backup.zip <button class="neon-btn" style="padding:4px 10px;font-size:0.93rem;">–°–∫–∞—á–∞—Ç—å</button></li>
    </ul>
  `;
}
function renderAdminErrors() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–°–ø–∏—Å–æ–∫ –æ—à–∏–±–æ–∫</div>
    <ul style="color:#ff3265;">
      <li>[2025-09-29 11:14] –û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å –¥–µ–≤–∞–π—Å–æ–º Xiaomi</li>
      <li>[2025-09-30 10:47] –ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å SMS</li>
    </ul>
  `;
}
function renderAdminBulk() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–ú–∞—Å—Å–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</div>
    <div>
      <select class="neon-input" style="width:180px;">
        <option>–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ</option>
        <option>–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—ã–µ</option>
        <option>–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å</option>
      </select>
      <button class="neon-btn" style="margin-left:10px;">–í—ã–ø–æ–ª–Ω–∏—Ç—å</button>
    </div>
  `;
}
function renderAdminMonitor() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥</div>
    <div>
      <canvas id="monitorCanvas" style="width:99%;height:80px;background:#13172a;border-radius:8px;margin-bottom:10px;" height="80"></canvas>
      <span>–†–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è: –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –≤–æ—Ä–∫–µ—Ä–æ–≤, –æ—à–∏–±–æ–∫.</span>
    </div>
  `;
  setTimeout(()=>{
    let can = document.getElementById('monitorCanvas');
    let ctx = can.getContext('2d');
    ctx.clearRect(0,0,can.width,can.height);
    for(let i=0;i<20;i++){
      ctx.fillStyle = "#00ffe7";
      ctx.globalAlpha = Math.random()*0.7+0.3;
      ctx.fillRect(i*can.width/20, 80-Math.random()*80, 10, Math.random()*80);
    }
    ctx.globalAlpha=1;
  },100);
}
function renderAdminAdvdash() {
  document.getElementById('adminTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–î–æ–ø. –î–∞—à–±–æ—Ä–¥</div>
    <div>
      <canvas id="advdashCanvas" style="width:99%;height:100px;background:#13172a;border-radius:8px;margin-bottom:10px;" height="100"></canvas>
      <span>–ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞ –≤—Å—ë –≤—Ä–µ–º—è.</span>
    </div>
  `;
  setTimeout(()=>{
    let can = document.getElementById('advdashCanvas');
    let ctx = can.getContext('2d');
    ctx.clearRect(0,0,can.width,can.height);
    ctx.strokeStyle="#00ffe7";
    ctx.beginPath();
    for(let i=0;i<20;i++){
      let y = 95 - Math.abs(Math.sin(i/3))*90;
      if(i===0) ctx.moveTo(i*can.width/20, y);
      else ctx.lineTo(i*can.width/20, y);
    }
    ctx.stroke();
  },100);
}

// 6. –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –Ω–æ–≤—ã—Ö –≤–∫–ª–∞–¥–æ–∫ –≤ renderAdminTab
const prevAdminTab = renderAdminTab;
renderAdminTab = function(tab) {
  document.querySelectorAll('#adminTabs .panel-tab').forEach(t=>t.classList.remove('active'));
  let sel = document.querySelector(`#adminTabs .panel-tab[data-tab="${tab}"]`);
  if(sel) sel.classList.add('active');
  switch(tab) {
    case 'reports': renderAdminReports(); break;
    case 'apitokens': renderAdminAPITokens(); break;
    case 'integrations': renderAdminIntegrations(); break;
    case 'calendar': renderAdminCalendar(); break;
    case 'docs': renderAdminDocs(); break;
    case 'faq': renderAdminFAQ(); break;
    case 'themes': renderAdminThemes(); break;
    case 'syslogs': renderAdminSyslogs(); break;
    case 'backups': renderAdminBackups(); break;
    case 'errors': renderAdminErrors(); break;
    case 'bulk': renderAdminBulk(); break;
    case 'monitor': renderAdminMonitor(); break;
    case 'advdash': renderAdminAdvdash(); break;
    default: prevAdminTab(tab);
  }
};

// 7. User —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏
function renderUserCalendar() {
  document.getElementById('userTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</div>
    <div>–í–∞—à–∏ —Å–æ–±—ã—Ç–∏—è –∏ –∑–∞–¥–∞—á–∏.<br>
    <input class="neon-input" type="date" style="margin-top:10px;">
    <ul style="color:#69fefd;margin-top:8px;">
      <li>2025-09-30: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</li>
      <li>2025-09-28: –û—Ç–ø—Ä–∞–≤–∫–∞ SMS</li>
    </ul>
    </div>
  `;
}
function renderUserFAQ() {
  document.getElementById('userTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">FAQ/–ü–æ–º–æ—â—å</div>
    <div>
      <details><summary>–ö–∞–∫ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞?</summary>–í–∫–ª–∞–¥–∫–∞ "–î–µ–≤–∞–π—Å—ã".</details>
      <details><summary>–ö–∞–∫ –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Ñ–∏–ª—å?</summary>–ö–Ω–æ–ø–∫–∞ "–ü—Ä–æ—Ñ–∏–ª—å" —Å–≤–µ—Ä—Ö—É –ø–∞–Ω–µ–ª–∏.</details>
    </div>
  `;
}
function renderUserThemes() {
  document.getElementById('userTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–¢–µ–º—ã/–°—Ç–∏–ª–∏</div>
    <div>
      <button class="neon-btn" onclick="toggleTheme()">üåó –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</button>
    </div>
  `;
}
function renderUserDocs() {
  document.getElementById('userTabContent').innerHTML = `
    <div style="font-size:1.13rem;color:#00ffe7;margin-bottom:10px;">–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è</div>
    <div>
      <ul style="text-align:left;color:#69fefd;">
        <li><a href="#" style="color:#00ffe7;">–ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –ø–∞–Ω–µ–ª—å—é</a></li>
        <li><a href="#" style="color:#00ffe7;">FAQ</a></li>
      </ul>
    </div>
  `;
}
const prevUserTab = renderUserTab;
renderUserTab = function(tab) {
  document.querySelectorAll('#userTabs .panel-tab').forEach(t=>t.classList.remove('active'));
  let sel = document.querySelector(`#userTabs .panel-tab[data-tab="${tab}"]`);
  if(sel) sel.classList.add('active');
  switch(tab) {
    case 'calendar': renderUserCalendar(); break;
    case 'faq': renderUserFAQ(); break;
    case 'themes': renderUserThemes(); break;
    case 'docs': renderUserDocs(); break;
    default: prevUserTab(tab);
  }
};
</script>